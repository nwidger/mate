<html>

<head>
<title>maTe Debugger (mdb)</title>
<link rev="made" href="mailto:hatcher@unh.edu">
</head>

<body>

<basefont size=4>

<h1>
maTe Debugger (mdb)
</h1>

<h2>
Table of Contents
</h2>

<a href="#introduction">Introduction</a><br>
<a href="#usage">Usage</a><br>
<a href="#tutorial">Tutorial</a><br>
<a href="#commands">Commands</a><br>

<p>

<a name="introduction"></a>
<h2>
Introduction
</h2>

The maTe debugger (mdb) provides a debugging environment for maTe
programs running in the maTe virtual machine (<a
href="mvm.pdf">mvm</a>).  mdb is designed to mimic gdb whenever
possible.  If you are already familiar with gdb, you should be able to
begin using mdb with little difficulty.

<p>

<a name="usage"></a>
<h2>
Usage
</h2>

For most debugging sessions, it is useful to pass a symbol table
generated by the maTe assember (<a href="mas.pdf">mas</a>) into mdb so
that it can resolve addresses to label names and vice versa.  To
create a symbol table <i>"foo.sym"</i> from an assembly-language file
<i>"foo.mas"</i>, invoke mas from the shell using the following
command:

<blockquote>
<i>mas -s < foo.mas > foo.sym</i>
</blockquote>

Pass the -d switch to mvm to enable the debugger.  For example, to run
the class file <i>"foo.class"</i> using the debugger, invoke mvm from
the shell using the command:

<blockquote>
<i>mvm -d foo.class</i>
</blockquote>

To allow mdb to use a symbol file generated using mas, pass it in
using the -s switch:

<blockquote>
<i>mvm -d -s foo.sym foo.class</i>
</blockquote>

<b>Note:</b> If you are using mdb, do not redirect input for your
program into mvm from the shell, as your input file will be
interpreted as commands to mdb!  Instead, start the debugger as shown
above and then redirect input from a file into your program using
arguments to the <i><a href="#run">run</a></i> command.

<p>

Using the -d switch, mvm will start at the mdb command prompt
<i>"(mdb) "</i>.  From the prompt you can issue any of the <a
href="#commands">commands</a> below.  Command names can be abbreviated
so long as they are not ambiguous.  Certain frequently used commands
are aliased to shorter versions for convenience.  For example, one can
use <i>b</i> to run the <i><a href="#break">break</a></i> command
although <i>b</i> would normally be ambiguous since it could match
either <i><a href="#backtrace">backtrace</a></i> or <i><a
href="#break">break</a></i>.  Any aliases for commands are listed
below.

<p>

Tab completion is available for commands, methods and filenames.  If a
symbol table is provided using the -s switch (see above), tab
completion for label names is also provided.

<p>

<a name="tutorial"></a>
<h2>
Tutorial
</h2>

Set breakpoints with the <i><a href="#break">break</a></i> command.
For example, to set a breakpoint at the label <i>mainBlock</i>, use
the command <i>break mainBlock</i>.  Inspect breakpoints with the
<i><a href="#info">info</a> breakpoints</i>.  Make sure breakpoints
you wish to use are enabled, you can enable/disable breakpoints with
the <i><a href="#enable">enable</a></i>/<i><a
href="#disable">disable</a></i> commands, passing one or more
breakpoint numbers as arguments.  Similarly, delete unneeded
breakpoints with the <i><a href="#delete">delete</a></i> command.

<p>

Start execution of the program with the <i><a href="#run">run</a></i>
command.  You can redirect input/output using a command like <i>run <
IN_FILE > OUT_FILE</i>.

<p>

Execution will stop because a breakpoint is encountered, the program
terminates or mvm encounters an error.  When one of these events
occur, mdb will return you to the command prompt.  To see the call
stack, run <i><a href="#backtrace">backtrace</a></i>.  You can move up
and down the call stack with the <i><a href="#up">up</a></i> and <i><a
href="#down">down</a></i> commands.  View the currently selected frame
with the <i><a href="#frame">frame</a></i> command.  The <i><a
href="#info">info</a></i> command can be used to inspect various
structures inside mvm.  Use the <i>info operand-stack</i> and <i>info
local-variable-array</i> commands to see the operand stack and local
variable array of the currently selected frame.  Each element of the
operand stack/local variable array is printed with its object
reference (ref=NUM) and class name (class=NAME).

<p>

For a complete printout of an object reference, use the <i><a
href="#print">print</a></i> command.  By default, the <i>print</i>
command lists the object reference, class name and fields of the
specified object.  If the object reference is a Integer, String or
Table or a subclass of one of those predefined types, you can print
the object reference as one of those types by passing a format
argument.  For example, to print the object reference 5 as an Integer
run the command <i>print /i 5</i>, to print it as a String run the
command <i>print /s 5</i> or to print it as a Table run the command
<i>print /t 5</i>.

<p>

While debugging, you can disassemble portions of the class file using
the <i><a href="#disassemble">disassemble</a></i> command.  By
default, <i>disassemble</i> will disassemble 10 instructions around
the current location of the selected frame.  Pressing <i>ENTER</i>
will continue the last printout, printing another 10 lines.  You can
pass an address or label name into <i>disassemble</i> to print out a
certain location in the class file.  For example, to disassemble
starting from the <i>mainBlock</i> label, run <i>disassemble
mainBlock</i>.

<p>

After inspecting the program's state sufficiently, you'll want to
resume execution of the program.  Several commands allow you to do
this, with differing semantics.  The <i><a
href="#continue">continue</a></i> command will resume execution, and
only stop if a breakpoint is hit.  The <i><a
href="#nexti">nexti</a></i> command will resume execution, stopping
after the current instruction is executed but skipping over
method/constructor invocations.  The <i><a href="#stepi">stepi</a></i>
command is similar to <i><a href="#nexti">nexti</a></i>, only it steps
into method/constructor invocations.  The <i><a
href="#finish">finish</a></i> command will resume execution, stopping
when the currently selected frame returns.

<p>

If you wish to restart the execution of the program from the
beginning, execute the <i><a href="#run">run</a></i> command again.
With no arguments, if you setup any input/output redirection
previously, those files will be rewound/truncated respectively (so
long as they're regular files).  When you want to exit mdb, simply run
<i><a href="#quit">quit</a></i>.

<p>

<a name="commands"</a>
<h2>
Commands
</h2>
<p>

Arguments in brackets <i>"[ ]"</i> are optional.  Arguments shown with
an elipse <i>"..."</i> appended to their name may be specified any
number of times, separated by whitespace.  A vertical bar <i>"|"</i>
separates the valid choices for an argument if there is more than one.


<p>

<a href="#add-symbol-file">add-symbol-file</a> - Load symbol table from symbol table file FILE.<br>
<a href="#backtrace">backtrace</a> - Print backtrace of all stack frames.<br>
<a href="#break">break</a> - Set a breakpoint at specified address or method.<br>
<a href="#continue">continue</a> - Continue program being debugged, after breakpoint.<br>
<a href="#delete">delete</a> - Delete some breakpoints.<br>
<a href="#disable">disable</a> -  Disable some breakpoints.<br>
<a href="#disassemble">disassemble</a> - Disassemble a specified section of the class file.<br>
<a href="#down">down</a> - Select and print stack frame called by this one.<br>
<a href="#enable">enable</a> - Enable some breakpoints.<br>
<a href="#finish">finish</a> - Execute until selected stack frame returns.<br>
<a href="#frame">frame</a> - Select and print a stack frame.<br>
<a href="#help">help</a> - Print list of commands.<br>
<a href="#info">info</a> - Generic command for showing things about the program being debugged.<br>
<a href="#jump">jump</a> - Continue program being debugged at specified address.<br>
<a href="#nexti">nexti</a> - Step one instruction, but proceed through method calls.<br>
<a href="#print">print</a> - Print value of object reference REF.<br>
<a href="#run">run</a> - Start debugged program.<br>
<a href="#set">set</a> - Write to class file in memory: set ADDRESS VALUE<br>
<a href="#stepi">stepi</a> - Step one instruction exactly.<br>
<a href="#until">until</a> - Execute until the program reaches an address greater than the current<br>
<a href="#up">up</a> - Select and print stack frame that called this one.<br>
<a href="#quit">quit</a> - Exit mdb.<br>
<a href="#x">x</a> - Examine memory: x /FMT ADDRESS.

<p>

<a name="add-symbol-file"></a>
<hr><h2>add-symbol-file</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>FILE</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Load symbol table from symbol table file FILE.
<p>
</blockquote>

<a name="backtrace"></a>
<hr><h2>backtrace</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>bt</i>
<td>
</Table><br></blockquote><pr>
<b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>FILE</i>
<td>
</Table><br></blockquote><pr>  
<b>Description</b><br>
<blockquote>
Print backtrace of all stack frames.<br>
Use of the 'full' qualifier also prints the values of the local variable array
and operand stack of each frame.
<p>
</blockquote>

<a name="break"></a>
<hr><h2>break</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>b</i>
<td>
</Table><br></blockquote><pr>  
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ ADDRESS | SYMBOL | METHOD_NAME ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Set a breakpoint at specified address or method.<br>
Argument may be an address, symbol or method name.<br>
If address is specified, break at instruction for that address.<br>
If symbol is specified, break at instruction at that label.<br>
If method is specified, break at start of code for that method.<br>
With no arg, uses current execution address of selected stack frame.<br>
This is useful for breaking on return to a stack frame.<br>
<br>
Multiple breakpoints at one place are permitted.
<p>
</blockquote>

<a name="continue"></a>
<hr><h2>continue</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
  <i>None</i>
</blockquote><pr>
<b>Description</b><br>
<blockquote>
Continue program being debugged, after breakpoint.
<p>
</blockquote>

<a name="delete"></a>
<hr><h2>delete</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>d</i>
<td>
</Table><br></blockquote><pr>  
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ NUM.. ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Delete some breakpoints.<br>
Arguments are breakpoint numbers with spaces in between.<br>
To delete all breakpoints, give no argument.
<p>
</blockquote>

<a name="disable"></a>
<hr><h2>disable</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>dis</i>
<td>
</Table><br></blockquote><pr>  
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ NUM.. ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Disable some breakpoints.<br>
Arguments are breakpoint numbers with spaces in between.<br>
To disable all breakpoints, give no argument.<br>
A disabled breakpoint is not forgotten, but has no effect until reenabled.
<p>
</blockquote>

<a name="disassemble"></a>
<hr><h2>disassemble</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>list</i>
<td>
</Table><br></blockquote><pr>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ ADDRESS | SYMBOL ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Disassemble a specified section of the class file.<br>
With no argument, disassemble ten more instructions after or around previous listing.<br>
One argument specifies an address or symbol, and ten instructions are listed from there.
<p>
</blockquote>

<a name="down"></a>
<hr><h2>down</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ NUM ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Select and print stack frame called by this one.<br>
An argument says how many frames down to go.
<p>
</blockquote>

<a name="enable"></a>
<hr><h2>enable</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ NUM.. ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Enable some breakpoints.<br>
Give breakpoint numbers (separated by spaces) as arguments.<br>
This is used to cancel the effect of the "disable" command.
<p>
</blockquote>

<a name="finish"></a>
<hr><h2>finish</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
  <i>None</i>
</blockquote><pr>
<b>Description</b><br>
<blockquote>
Execute until selected stack frame returns.
<p>
</blockquote>

<a name="frame"></a>
<hr><h2>frame</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>f</i>
<td>
</Table><br></blockquote><pr>  
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ NUM ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Select and print a stack frame.<br>
With no argument, print the selected stack frame.  (See also "info frame").<br>
An argument specifies the frame to select.
<p>
</blockquote>

<a name="help"></a>
<hr><h2>help</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ COMMAND ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Print list of commands.
<p>
</blockquote>

<a name="info"></a>
<hr><h2>info</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ breakpoints | class-table | frame | garbage-collector | heap | instruction-table | local-variable-array | method-area | native-method-array | operand-stack | registers | symbol-table | vm-stack ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Generic command for showing things about the program being debugged.<br>
<br>
breakpoints - Status of user-settable breakpoints.<br>
class-table - List classes in class file.<br>
frame - All about selected stack frame.<br>
garbage-collector - List garbage collector information.<br>
heap - List heap information.<br>
instruction-table - List instructions and their opcodes.<br>
local-variable-array - List local variable array of current stack frame.<br>
method-area - List information about currently loaded class file.<br>
native-method-array - List native methods and their indices.<br>
operand-stack - List operand stack of current stack frame.<br>
registers - List of all registers and their contents.<br>
symbol-table - List all symbols in symbol table.<br>
vm-stack - Backtrace of the stack.
<p>
</blockquote>

<a name="jump"></a>
<hr><h2>jump</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>ADDRESS | SYMBOL</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Continue program being debugged at specified address.<br>
Give as argument either address or symbol for the address to start at.  
<p>
</blockquote>

<a name="nexti"></a>
<hr><h2>nexti</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
  <i>None</i>
</blockquote><pr>
<b>Description</b><br>
<blockquote>
Step one instruction, but proceed through method calls.
<p>
</blockquote>

<a name="print"></a>
<hr><h2>print</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ /FMT ]</i>
<td>
<tr><td>
  <i>REF</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Print value of object reference REF.<br>
REF may be preceded by /FMT, where FMT is one of:<br>
<br>
o - print REF as an Object (also lists fields).<br>
i - print REF as an Integer.<br>
s - print REF as a String.<br>
t - print REF as a Table.
<p>
</blockquote>

<a name="run"></a>
<hr><h2>run</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ < FILE ]</i>
<td>
<tr><td>
  <i>[ > FILE ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Start debugged program.<br>
Input and output redirection with ">" or "<" is allowed.
<p>
</blockquote>

<a name="set"></a>
<hr><h2>set</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ ADDRESS ]</i>
<td>
<tr><td>
  <i>[ VALUE ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Write to class file in memory: set ADDRESS VALUE.
<p>
</blockquote>
  
<a name="stepi"></a>
<hr><h2>stepi</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>s</i>
<td>
</Table><br></blockquote><pr>  
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
  <i>None</i>
</blockquote><pr>
<b>Description</b><br>
<blockquote>
Step one instruction exactly.
<p>
</blockquote>

<a name="until"></a>
<hr><h2>until</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ ADDRESS | SYMBOL ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Execute until the program reaches an address greater than the current<br>
or a specified location (given as an address or symbol) within the current frame.
<p>
</blockquote>

<a name="up"></a>
<hr><h2>up</h2>
<p><b>Aliases</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>u</i>
<td>
</Table><br></blockquote><pr>  
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ NUM ]</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Select and print stack frame that called this one.<br>
An argument says how many frames up to go.
<p>
</blockquote>

<a name="quit"></a>
<hr><h2>quit</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
  <i>None</i>
</blockquote><pr>
<b>Description</b><br>
<blockquote>
Exit mdb.
<p>
</blockquote>

<a name="x"></a>
<hr><h2>x</h2>
<p><b>Arguments</b><br>
<Table Border="1">
<blockquote>
<tr><td>
  <i>[ /FMT ]</i>
<td>
<tr><td>
  <i>ADDRESS</i>
<td>
</Table><br></blockquote><pr>
<b>Description</b><br>
<blockquote>
Examine memory: x /FMT ADDRESS<br>
ADDRESS is an address in the class file.<br>
FMT is a format letter.<br>
Format letters are o(octal), x(hex), u(unsigned decimal),<br>
i(instruction), c(char) and s(string).
<p>
</blockquote>
  
<hr size=3 noshade>
Last modified on April 25, 2010.<p>
Comments and questions should be directed to
<a href="mailto:hatcher@unh.edu">hatcher@unh.edu</a>

